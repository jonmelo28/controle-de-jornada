<%- include('../partials/header') %>
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4>Permissões</h4>
    <a class="btn btn-primary" href="/permissoes/novo">Nova Permissão</a>
  </div>

  <% if (ok) { %><div class="alert alert-success">Operação realizada (<%= ok %>).</div><% } %>
  <% if (erro) { %>
    <div class="alert alert-danger">
      <% if (erro === 'perm_em_uso') { %>Não é possível excluir: permissão vinculada a funções.<% } 
         else if (erro === 'delete_fail') { %>Erro ao excluir permissão.<% }
         else if (erro === 'notfound') { %>Permissão não encontrada.<% }
         else { %>Ocorreu um erro.<% } %>
    </div>
  <% } %>

  <div class="table-responsive">
    <table class="table table-sm table-bordered align-middle">
      <thead class="table-dark">
        <tr>
          <th>Chave</th>
          <th>Descrição</th>
          <th class="text-center">Em Funções</th>
          <th class="text-end">Ações</th>
        </tr>
      </thead>
      <tbody>
        <% permissoes.forEach(p => { %>
          <tr>
            <td><code><%= p.chave %></code></td>
            <td><%= p.descricao || '-' %></td>
            <td class="text-center"><%= p.qt_funcoes %></td>
            <td class="text-end">
              <a class="btn btn-sm btn-outline-secondary" href="/permissoes/<%= p.id %>/editar">Editar</a>
              <form action="/permissoes/<%= p.id %>/excluir" method="post" class="d-inline" onsubmit="return confirm('Excluir permissão?');">
                <button class="btn btn-sm btn-outline-danger" type="submit">Excluir</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>
<%- include('../partials/footer') %>
