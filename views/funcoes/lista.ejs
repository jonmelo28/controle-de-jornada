<%- include('../partials/header') %>
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4>Funções</h4>
    <a class="btn btn-primary" href="/funcoes/novo">Nova Função</a>
  </div>

  <% if (ok) { %><div class="alert alert-success">Operação realizada (<%= ok %>).</div><% } %>
  <% if (erro) { %>
    <div class="alert alert-danger">
      <% if (erro === 'role_em_uso') { %>Não é possível excluir: existem usuários nessa função.<% } 
         else if (erro === 'delete_fail') { %>Erro ao excluir função.<% }
         else if (erro === 'notfound') { %>Função não encontrada.<% }
         else { %>Ocorreu um erro.<% } %>
    </div>
  <% } %>

  <div class="table-responsive">
    <table class="table table-sm table-bordered align-middle ">
      <thead class="table-dark">
        <tr>
          <th>Nome</th>
          <th>Descrição</th>
          <th class="text-center">Usuários</th>
          <th class="text-center">Permissões</th>
          <th class="text-end">Ações</th>
        </tr>
      </thead>
      <tbody>
        <% roles.forEach(r => { %>
          <tr>
            <td><%= r.nome %></td>
            <td><%= r.descricao || '-' %></td>
            <td class="text-center"><%= r.qt_usuarios %></td>
            <td class="text-center"><%= r.qt_permissoes %></td>
            <td class="text-end">
              <a class="btn btn-sm btn-outline-secondary" href="/funcoes/<%= r.id %>/editar">Editar</a>
              <form action="/funcoes/<%= r.id %>/excluir" method="post" class="d-inline" onsubmit="return confirm('Excluir função?');">
                <button class="btn btn-sm btn-outline-danger" type="submit">Excluir</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>
<%- include('../partials/footer') %>
